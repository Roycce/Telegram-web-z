version: "3.9"
services:
  telegram-web-a:
    image: node:22-alpine
    container_name: telegram-web-a
    working_dir: /app
    environment:
      TELEGRAM_API_ID: "${TELEGRAM_API_ID}"
      TELEGRAM_API_HASH: "${TELEGRAM_API_HASH}"
      PORT: 1234
    ports:
      - "1234:1234"   # ← ЗДЕСЬ! На одном уровне с environment, volumes и т.д.
    command: >
      sh -c "
        apk add --no-cache git && \
        rm -rf /tmp/repo /app/* /app/.* || true && \
        git clone --depth 1 https://github.com/Roycce/Telegram-web-z.git /tmp/repo && \
        cp -r /tmp/repo/. /app/ && \
        echo 'Files in /app/:' && ls -la /app/package.json || exit 1 && \
        cd /app && \
        echo 'Installing dependencies...' && \
        npm install --verbose && \
        echo 'Starting dev server...' && \
        npx cross-env APP_ENV=development PORT=1234 webpack serve --mode development --port 1234
      "
    volumes:
      - telegram-web-a-data:/app
    networks:
      - docker_infra-net

networks:
  docker_infra-net:
    external: true

volumes:
  telegram-web-a-data:
